<div layout="row" layout-wrap class="product-list" ng-class="{'active' : $ctrl.list}">  
    <div ng-if="$ctrl.list" ng-repeat="item in $ctrl.list" flex-xs="100" flex-sm="50" flex="25" ng-init="imgIndex=0; sizeIndex=0;" class="card-item-wrap" ng-class="{'removed': item.status == 0, 'hide': !$ctrl.isShow(item.tags)}">
        <md-card class="card-item">
            <div class="sale-box" ng-if="item.size && item.size.length > 0 && 0 === sizeIndex">
                <span class="sale-label" ng-class="{'notavail': item.quantity <= 0}">
                    {{item.quantity > 0 ? item.size : 'Tạm hết'}}
                </span>
            </div>       
            <div class="card-image" ng-class="{'ng-hide-add': 0 === sizeIndex, 'ng-hide-remove': 0 !== sizeIndex}">
                <div ng-repeat="img in item.images" class="img" ng-class="{'ng-hide-add': $index === imgIndex, 'ng-hide-remove': $index !== imgIndex}" background-src="img" size="$ctrl.deviceSize">
                    <div show-details item="item" index="imgIndex" style="width: 100%; height: 100%"></div>
                </div>
                <div class="nav">
                    <md-radio-group ng-model="imgIndex" layout="row">
                        <md-radio-button ng-value="$index" ng-repeat="img in item.images" aria-label="{{item.name}}"></md-radio-button>
                    </md-radio-group>
                </div>
            </div>
            <div ng-class="{'ng-hide-add': 0 === sizeIndex, 'ng-hide-remove': 0 !== sizeIndex}">
                <div class="card-name" align="center">{{item.name}} <small class="hot" ng-if="item.special">HOT</small></div>
                <div class="card-money">{{item.money | money}}</div>
            </div>
            <div class="des" style="position: absolute; top: 0px; left: 0px;" ng-class="{'ng-hide-add': 1 === sizeIndex, 'ng-hide-remove': 1 !== sizeIndex}">
                <md-card-content ng-show="!$ctrl.isSell">
                    <img image-src="item.images[0]" size="'thumb'" width="32" style="float: left; border-radius: 100%; margin: 8px 8px 0px 0px;" />
                    <div class="card-name">{{item.name}}</div>
                    <div class="card-des">{{item.des}}</div>
                    <div class="card-des" ng-if="$root.isAuth">Các size còn:<br/> 
                        <span class="card-name" ng-repeat="s in item.sizes" title="Remain {{s.quantity}}/ {{s.quantity0}}" ng-if="s.quantity > 0">
                            <a href="#" ng-if="s.quantity > 0" class="card-name" ng-click="$ctrl.addSell(item, $index)">{{s.size}}</a>
                        </span>
                    </div>
                </md-card-content>
                <md-card-content ng-show="$ctrl.isSell" layout="row" layout-wrap layout-align="end center">
                    <md-input-container class="md-block" flex="70" md-no-float>
                        <md-datepicker ng-model="$ctrl.trans.created_date" aria-label="Ngày mua" md-placeholder="Ngày mua" md-max-date="$ctrl.today"></md-datepicker>
                    </md-input-container>
                    <div align="right" flex="30"><a href="#" ng-click="$ctrl.isSell = 0;"><span class="card-name">{{$ctrl.sizeName}}</span></a></div>
                    <md-input-container class="md-block" flex="100" md-no-float style="margin: 0px 0px 16px 0px">
                        <md-autocomplete
                            md-no-cache="false"
                            md-search-text="$ctrl.searchText"
                            md-items="item in $ctrl.querySearchBuyer($ctrl.searchText)"
                            md-search-text-change="$ctrl.searchTextChange($ctrl.searchText)"
                            md-selected-item-change="$ctrl.selectedItemChange(item)"
                            md-item-text="item.buyer"
                            md-min-length="0"
                            placeholder="Tên khách hàng">
                            <md-item-template>
                                <span md-highlight-text="$ctrl.searchText" md-highlight-flags="^i">{{item.buyer}} - {{item.phone}}</span>
                            </md-item-template>
                        </md-autocomplete>
                    </md-input-container>
                    <md-input-container class="md-block" flex="50" md-no-float>
                        <input ng-model="$ctrl.trans.phone" placeholder="Điện thoại">
                    </md-input-container>
                    <md-input-container class="md-block" flex="50">
                        <label>Nhóm buôn bán</label>
                        <md-select ng-model="$ctrl.trans.channel_name" style="width: 100%">
                            <md-option ng-repeat="c in $ctrl.channels" ng-value="c.code">
                                {{c.name}}
                            </md-option>
                        </md-select>
                    </md-input-container>
                    <md-input-container class="md-block" flex="100" md-no-float>
                        <textarea ng-model="$ctrl.trans.address" md-maxlength="150" rows="1" md-select-on-focus placeholder="Địa chỉ"></textarea>
                    </md-input-container>
                    <md-input-container class="md-block" flex="50" md-no-float>
                        <input ng-model="$ctrl.trans.quantity" placeholder="Quantity">
                    </md-input-container>
                    <div flex>
                        <md-button ng-click="$ctrl.sell()" class="md-primary">
                            <md-icon>shopping_basket</md-icon>
                        </md-button>
                    </div>
                </md-card-content>
            </div>
            <md-card-actions layout="row" layout-align="end center" ng-if="!$root.isAuth">
            </md-card-actions>
            <md-card-actions layout="row" layout-align="end center" ng-if="$root.isAuth">
                <div style="display: relative">       
                    <md-button aria-label="menu" class="md-icon-button" ng-click="isOpen = !isOpen">
                        <md-icon aria-label="menu">gavel</md-icon>
                    </md-button>
                    <div ng-show="isOpen" style="position: absolute; bottom: 50px; z-index: 1; left: 16px;">             
                        <md-button class="md-icon-button" aria-label="Edit" ng-click="isOpen = !isOpen; $ctrl.edit(item)" du-smooth-scroll="addItem">
                            <md-icon>edit</md-icon>
                        </md-button><br/>
                        <md-button class="md-icon-button" aria-label="Delete" ng-click="isOpen = !isOpen; $ctrl.delete(item)">
                            <md-icon>delete</md-icon>
                        </md-button>
                    </div>
                </div>
                <input type="number" style="width: 50px" placeholder="Thứ tự" ng-model="item.position" ng-blur="$ctrl.update(item)" />
                <md-button class="md-icon-button" aria-label="Status" ng-click="$ctrl.toggleVisible(item)">
                    <md-icon ng-if="item.status">visibility</md-icon>
                    <md-icon ng-if="!item.status">visibility_off</md-icon>
                </md-button>                
                <div flex></div>
                <md-button class="md-icon-button" aria-label="Details" ng-click="$parent.sizeIndex = $parent.sizeIndex ? 0 : 1;">
                    <md-icon ng-if="!sizeIndex">more_horiz</md-icon>
                    <md-icon ng-if="sizeIndex">keyboard_arrow_left</md-icon>
                </md-button>               
            </md-card-actions>
        </md-card>
    </div>
    <div class="card-item-wrap" flex-xs="100" flex-sm="50" flex="40" id="addItem" ng-if="$root.isAuth">
        <md-card class="card-item add">
            <md-card-content ng-if="$ctrl.isAdd">
                <div align="right">
                    <md-button class="md-icon-button" ng-click="$ctrl.isAdd = !$ctrl.isAdd;" ng-if="$ctrl.isAdd">
                        <md-icon>close</md-icon>
                    </md-button>
                </div>
                <upload-file file-model="$ctrl.p.images" name="images" img-src="$ctrl.p.images ? $ctrl.p.images[0] : undefined" ></upload-file>
                <md-switch class="md-primary" md-no-ink aria-label="Special" ng-model="$ctrl.p.special">
                    Hàng HOT ?
                </md-switch>
                <div layout="row">  
                    <md-input-container flex="50">
                        <label>Tên sản phẩm</label>
                        <input ng-model="$ctrl.p.name">
                    </md-input-container>
                    <md-datepicker ng-model="$ctrl.p.created_date" aria-label="Ngày nhập" md-placeholder="Ngày nhập" md-max-date="$ctrl.today" flex="50"></md-datepicker>
                </div>
                <md-input-container class="md-block">
                    <label>Mô tả sản phẩm</label>
                    <textarea ng-model="$ctrl.p.des" md-maxlength="300" rows="2"></textarea>
                </md-input-container>          
                <div layout="row">      
                    <md-input-container class="md-block" flex="50">
                        <label>Bán ra</label>
                        <input ng-model="$ctrl.p.money" type="number" placeholder="$">
                    </md-input-container>                    
                    <md-input-container class="md-block" flex="50">
                        <label>Nhóm buôn bán</label>
                        <md-select ng-model="$ctrl.p.category_id" ng-if="$ctrl.categories">
                            <md-option ng-repeat="c in $ctrl.categories" ng-value="c._id">
                                {{c.name}}
                            </md-option>
                        </md-select>
                    </md-input-container>
                </div>
                <div layout="row">
                    <md-input-container class="md-block" flex="80">
                        <label>Kích cỡ hiển thị</label>
                        <input ng-model="$ctrl.p.size" type="text" placeholder="Size desc">
                    </md-input-container>
                    <md-button class="md-icon-button" aria-label="Add" ng-click="$ctrl.p.sizes.push({size: '', quantity: ''});">
                        <md-icon>add</md-icon>
                    </md-button>                    
                </div>
                <div layout="row" ng-repeat="s in $ctrl.p.sizes" ng-if="$ctrl.p && $ctrl.p.sizes">
                    <md-input-container class="md-block" flex>
                        <label>Kích cỡ</label>
                        <input ng-model="s.size" type="text" placeholder="S">
                    </md-input-container>
                    <md-input-container class="md-block" flex="25">
                        <label>SL còn lại</label>
                        <input ng-model="s.quantity" type="number" placeholder="0">
                    </md-input-container>
                    <md-input-container class="md-block" flex="25">
                        <label>SL ban đầu</label>
                        <input ng-model="s.quantity0" type="number" placeholder="0">                        
                    </md-input-container>
                    <md-input-container class="md-block" flex="10">
                        <md-icon class="button" ng-click="$ctrl.p.sizes.splice($index, 1);">remove</md-icon>
                    </md-input-container>
                </div>
                <br/><br/>
                <div layout="row">
                    <md-input-container class="md-block" flex="50">
                        <label>Nhập vào</label>
                        <input ng-model="$ctrl.p.money0" type="number" placeholder="$">
                    </md-input-container>
                    <md-input-container class="md-block" flex="50">
                        <label>Số lượng nhập</label>
                        <input ng-model="$ctrl.p.quantity0" type="number" readonly />
                    </md-input-container>
                </div>
                <fieldset class="standard" >
                    <legend>Tags</legend>
                    <div layout="row" layout-wrap flex>
                        <div flex="100" ng-repeat="t in $ctrl.tags">
                            <md-checkbox ng-checked="$ctrl.exists(t)" ng-click="$ctrl.toggle(t)">
                                {{ t.name }}
                            </md-checkbox>
                        </div>
                    </div>
                </fieldset>
            </md-card-content>
            <md-card-actions layout="row" layout-align="end center">
                <md-button class="md-icon-button" aria-label="Favorite" ng-click="$ctrl.save($ctrl.p)" ng-if="$ctrl.isAdd">
                    <md-icon>save</md-icon>
                </md-button>
                <md-button class="md-icon-button" ng-click="$ctrl.createNew()" ng-if="!$ctrl.isAdd">
                    <md-icon>add</md-icon>
                </md-button>
            </md-card-actions>
        </md-card>
    </div>
</div>